
@{
    Layout = null;
}

<!DOCTYPE html>
<html>
<head>
    <meta name="viewport" content="width=device-width" />
    <title>充值重开</title>
    <link rel="stylesheet" type="text/css" href="@Url.ContentVersioned("~/layui/css/layui.css")" media="all">
    <style>
        .layui-form-item {
            margin-bottom: 7px;
        }
    </style>
</head>
<body>
    <div style=" padding:7px;">
        <ul class="layui-nav" lay-filter="" style=" margin-bottom:10px;">
            <li class="layui-nav-item layui-this" id="b1"><a>编辑基本信息</a></li>
            <li class="layui-nav-item disabled" id="b2"><a>编辑设置</a></li>
            <li class="layui-nav-item disabled" id="b3"><a>完成</a></li>
        </ul>
        <form class="layui-form layui-form-pane" action="">
            @*第一步*@
            <input type="hidden" id="image1" value="" />
            <input type="hidden" id="image2" value="" />
            <input type="hidden" id="image1url" value="" />
            <input type="hidden" id="image2url" value="" />
            <div id="number1" style=" margin-top:20px;">
                <div class="layui-form-item">
                    <label class="layui-form-label">活动类型</label>
                    <div class="layui-input-block" style=" width:190px; ">
                        <select id="AType">
                            <option value="">请选择</option>
                            <option value="1">幸运转转乐</option>
                            @*<option value="2">幸运开火车</option>*@
                        </select>
                    </div>
                </div>
                <div class="layui-form-item">
                    <label class="layui-form-label">活动标题</label>
                    <div class="layui-input-inline">
                        <input type="text" name="Title" id="Title" maxlength="30" lay-verify="required" placeholder="活动标题" autocomplete="off" class="layui-input">
                    </div>
                </div>
                <div class="layui-form-item">
                    <label class="layui-form-label">背景图片</label>
                    <div class="layui-input-block">
                        <button type="button" class="layui-btn" id="uploadMaster" style=" display:none;">
                            <i class="layui-icon">&#xe67c;</i>
                        </button>

                        <button type="button" class="layui-btn" id="upload1" style="margin-left:10px;width:172px;">
                            <i class="layui-icon">&#xe67c;</i>编辑图片
                        </button>
                    </div>
                </div>
                <div class="layui-form-item">
                    <label class="layui-form-label">banner图</label>
                    <div class="layui-input-block">
                        <button type="button" class="layui-btn" id="upload2" style="margin-left:10px; width:172px;">
                            <i class="layui-icon">&#xe67c;</i>编辑图片
                        </button>
                    </div>
                </div>

                <div class="layui-form-item">
                    <div class="layui-inline">
                        <label class="layui-form-label">开始日期</label>
                        <div class="layui-input-block">
                            <input type="text" name="date" id="StartDate" placeholder="年-月-日" autocomplete="off" class="layui-input">
                        </div>
                    </div>
                    <div class="layui-inline">
                        <label class="layui-form-label">每日开始时间</label>
                        <div class="layui-input-inline">
                            <input type="text" id="StartTime" placeholder="时:分:秒" autocomplete="off" class="layui-input">
                        </div>
                    </div>
                </div>

                <div class="layui-form-item">
                    <div class="layui-inline">
                        <label class="layui-form-label">结束日期</label>
                        <div class="layui-input-block">
                            <input type="text" name="date" id="EndDate" placeholder="年-月-日" autocomplete="off" class="layui-input">
                        </div>
                    </div>
                    <div class="layui-inline">
                        <label class="layui-form-label">每日结束时间</label>
                        <div class="layui-input-inline">
                            <input type="text" id="EntTime" placeholder="时:分:秒" autocomplete="off" class="layui-input">
                        </div>
                    </div>
                </div>

                @*<div class="layui-form-item">
                        <div class="layui-inline">
                            <div class="layui-inline">
                                <label class="layui-form-label">抽奖消耗：</label>
                            </div>
                            <div class="layui-inline">
                                <label class="layui-form-label">消费积分</label>
                                <div class="layui-input-block">
                                    <input type="text" autocomplete="off" class="layui-input" id="ConsumeScore" style=" width:57px;" placeholder="0" value="0">
                                </div>
                            </div>
                            <div class="layui-inline">
                                <label class="layui-form-label">分销积分</label>
                                <div class="layui-input-inline">
                                    <input type="text" autocomplete="off" class="layui-input" id="DistributionScore" style=" width:50px;" placeholder="0" value="0">
                                </div>
                            </div>
                        </div>

                        <div class="layui-form-item" pane="">
                            <label class="layui-form-label">优先使用</label>
                            <div class="layui-input-block">
                                <input type="radio" name="PriorityUse" value="0" title="消费积分" checked="">
                                <input type="radio" name="PriorityUse" value="1" title="分销积分">
                            </div>
                        </div>
                    </div>*@
                <div class="layui-form-item">
                    <label class="layui-form-label">抽奖次数</label>
                    <div class="layui-input-inline">
                        <input type="text" name="LotteryNumber" id="LotteryNumber" lay-verify="required" maxlength="10" placeholder="抽奖次数" autocomplete="off" class="layui-input">
                    </div>
                </div>
                <div class="layui-form-item layui-form-text">
                    <label class="layui-form-label">活动规则</label>
                    <div class="layui-input-block">
                        <textarea placeholder="请输入活动规则" id="ARule" class="layui-textarea"></textarea>
                    </div>
                </div>
                <div class="layui-form-item">
                    <input class="layui-btn" type="button" value="下一步" id="next" style="width:100px;" />
                    <input class="layui-btn layui-btn-primary" type="button" id="colseBtn" style="width:100px;" value="取消" />
                </div>
            </div>

            @*第二步*@

            <div id="number2" style="display:none; margin-top:20px;">
                <table class="layui-table" lay-size="sm">
                    <colgroup>
                        <col width="70">
                        <col width="100">
                        <col width="150">
                    </colgroup>
                    <thead>
                        <tr>
                            <th>序号</th>
                            <th>奖项</th>
                            <th>奖品名称</th>
                            <th>奖品详情</th>
                            <th>奖品类型</th>
                            <th>奖品数量</th>
                            <th>奖品价值</th>
                            <th>中奖概率</th>
                        </tr>
                    </thead>
                    <tbody id="tbl"></tbody>
                </table>
                <div class="layui-upload-list">
                    <table class="layui-table">
                        <thead>
                            <tr>
                                <th>类型</th>
                                <th>文件名</th>
                                <th>大小</th>
                                <th>状态</th>
                                <th>操作</th>
                            </tr>
                        </thead>
                        <tbody id="demoList"></tbody>

                    </table>
                </div>
                <div class="layui-form-item">
                    <input class="layui-btn" type="button" value="上一步" id="Back" style="width:100px;" />
                    <input type="hidden" id="BtnUploadImage" />
                    <input class="layui-btn" type="button" value="复制重开" id="success" style="width:100px; margin-left: 10px; " />
                    <input class="layui-btn layui-btn-primary" type="button" id="colseBtn1" style="width:100px;" value="取消" />
                </div>
            </div>

        </form>
    </div>
    <script type="text/javascript" src="@Url.ContentVersioned("~/Scripts/jquery-1.10.2.min.js")"></script>
    <script type="text/javascript" src="@Url.ContentVersioned("~/layui/layui.js")"></script>
    <script>
        function getUrlParam(name) {
            var reg = new RegExp("(^|&)" + name + "=([^&]*)(&|$)"); //构造一个含有目标参数的正则表达式对象
            var r = window.location.search.substr(1).match(reg);  //匹配目标参数
            if (r != null) return unescape(r[2]); return null; //返回参数值
        }

        function checkvalue(o) {
            o.value = o.value.replace(/[^\d]/g, '');
        }

        function checkvalue1(o) {
            o.value = o.value.replace(/[^\d]/g, '');
            var zhi = 0;
            var count = 0;
            $("#tbl input[id^='Probability']").each(function () {
                if ($(this).val() != "") {
                    count++;
                    zhi += $(this).val() * 1;
                }
            });
            if (zhi > 100) {
                layer.msg("请检查设置，中奖率相加必须等于100%");
                o.value = "";
            }
            //if (count == 8 && zhi != 100) {
            //    layer.msg("请检查设置，中奖率相加必须等于100%");
            //}
        }

        layui.use(['form', 'table', 'laydate', 'upload'], function () {
            var index = parent.layer.getFrameIndex(window.name); //获取窗口索引
            var table = layui.table;
            var form = layui.form;
            var $ = layui.jquery, layer = layui.layer; //独立版的layer无需执行这一句
            var laydate = layui.laydate;
            var upload = layui.upload;
            var getList = {};
            $.ajax({
                url: "/ActivityManage/GetPrizeSettingList",
                dataType: "json",
                async: false,
                success: function (data) {
                    getList = data;
                }
            });
            var id = getUrlParam("id");
            var UpdateActivityPm = {
                ActivityID: id
            };

            $.ajax({
                url: "/ActivityManage/SingleActivityInfo",
                dataType: "json",
                async: false,
                data: UpdateActivityPm,
                success: function (data) {
                    $("#image1url").val(data.data.BGImg);
                    var htmls = "<span class=\"layui-inline layui-upload-choose\"><a href='" + data.data.BGImg + "' target=\"_blank\" >点击查看图片</a></span>";
                    $("#upload1").after(htmls);
                    $("#image2url").val(data.data.BannerImg);
                    var htmls = "<span class=\"layui-inline layui-upload-choose\"><a href='" + data.data.BannerImg + "' target=\"_blank\" >点击查看图片</a></span>";
                    $("#upload2").after(htmls);

                    $("#AType").val(data.data.AType);
                    $("#Title").val(data.data.Title);
                    $("#StartDate").val(data.data.StartDate);
                    $("#EndDate").val(data.data.EndDate);
                    $("#StartTime").val(data.data.StartTime);
                    $("#EntTime").val(data.data.EntTime);
                    $("#LotteryNumber").val(data.data.LotteryNumber);
                    //$("#ConsumeScore").val(data.data.ConsumeScore);
                    //$("#DistributionScore").val(data.data.DistributionScore);
                    $("#ARule").html(data.data.ARule);
                    $("input[name='PriorityUse'][value=" + data.data.PriorityUse + "]").prop("checked", true);
                    form.render(); //更新全部
                    var tabhtml = "";
                    for (var i = 0; i < data.data.Activity_PrizeSetting.length; i++) {
                        tabhtml += " <tr>";
                        tabhtml += "<td>" + (i + 1) + "</td>";
                        tabhtml += " <td>";
                        tabhtml += "<select id=\"ATypes" + i + "\" style='width:100px;'>";
                        if (data.data.Activity_PrizeSetting[i].Awards == "1")
                            tabhtml += "<option value=\"1\" selected=\"selected\">特等奖</option>";
                        else
                            tabhtml += "<option value=\"1\">特等奖</option>";

                        if (data.data.Activity_PrizeSetting[i].Awards == "2")
                            tabhtml += "<option value=\"2\" selected=\"selected\">一等奖</option>";
                        else
                            tabhtml += "<option value=\"2\">一等奖</option>";

                        if (data.data.Activity_PrizeSetting[i].Awards == "3")
                            tabhtml += "<option value=\"3\" selected=\"selected\" >二等奖</option>";
                        else
                            tabhtml += "<option value=\"3\">二等奖</option>";

                        if (data.data.Activity_PrizeSetting[i].Awards == "4")
                            tabhtml += "<option value=\"4\" selected=\"selected\">三等奖</option>";
                        else
                            tabhtml += "<option value=\"4\">三等奖</option>";

                        tabhtml += "</select>";
                        tabhtml += "</td>";
                        tabhtml += "<td>";
                        tabhtml += "<input type='hidden' id='PrizeID" + i + "' value='" + data.data.Activity_PrizeSetting[i].ID + "'  />";
                        //
                        tabhtml += "<select name='PName" + i + "' lay-filter=\"test\" key=\"" + i + "\"  >";
                        tabhtml += "<option value=\"\">请选择</option>";
                        var PDetails = "";
                        var PType = "";
                        var Pworth = "";
                        for (var j = 0; j < getList.count; j++) {
                            if (data.data.Activity_PrizeSetting[i].PrizeID == getList.data[j].ID) {
                                tabhtml += "<option  value=\"" + getList.data[j].ID + "\" selected=\"selected\" >" + getList.data[j].PName + "</option>";
                                PDetails = getList.data[j].PDetails;
                                Pworth = getList.data[j].Pworth;
                                PType = getList.data[j].TypeName;
                            }
                            else
                                tabhtml += "<option  value=\"" + getList.data[j].ID + "\">" + getList.data[j].PName + "</option>";
                        }
                        tabhtml += "</select > ";
                        tabhtml += "</td> ";
                        tabhtml += "<td id=\"PDetails" + i + "\">" + PDetails + "</td>";
                        tabhtml += "<td id=\"PType" + i + "\">" + PType + "</td>";
                        tabhtml += "<td><input type=\"text\" onkeyup='checkvalue(this);' maxlength=\"8\"   value='" + data.data.Activity_PrizeSetting[i].Inventory + "' autocomplete=\"off\" class=\"layui-input\" id=\"Inventory" + i + "\" style=\" width: 57px; \" placeholder=\"\"></td>";
                        tabhtml += "<td id=\"Pworth" + i + "\">" + Pworth + "</td>";
                        tabhtml += "<td><div style='width:58px;float:left;'><input type=\"text\" value='" + (data.data.Activity_PrizeSetting[i].Probability * 100) + "' onkeyup='checkvalue1(this);' onblur='checkvalue1(this);' maxlength=\"3\" autocomplete=\"off\" class=\"layui-input\" id=\"Probability" + i + "\" style=\" width: 55px;\" placeholder=\"\"></div><i style='float:left;line-height:38px;'>%</i></td>";
                    }
                    $("#tbl").html(tabhtml);
                }
            });


            form.on('select(test)', function (data) {
                var key = $(data.elem).attr("key");
                var count = data.value;
                var eml = getElem(getList, count)
                $("#PDetails" + key).html(eml.PDetails);
                $("#PType" + key).html(eml.TypeName);
                $("#Pworth" + key).html(eml.Pworth);
            });

            function getElem(getList, id) {
                for (var i = 0; i < getList.count; i++) {
                    if (getList.data[i].ID == id) {
                        return getList.data[i];
                    }
                }
            }
            form.render('select');
            form.render("select", "selFilter");

            //执行一个laydate实例
            laydate.render({
                elem: '#StartDate' //指定元素
            });
            laydate.render({
                elem: '#EndDate' //指定元素
            });
            laydate.render({
                elem: '#StartTime', type: 'time'
            });
            laydate.render({
                elem: '#EntTime', type: 'time'
            });

            $("#colseBtn").on("click", function () {
                parent.layer.close(index);
            });

            $("#colseBtn1").on("click", function () {
                parent.layer.close(index);
            });
            var demoListView = $('#demoList')
            var type = 0;
            upload.render({
                elem: '#uploadMaster'
                , url: '/Admin/Upload/UpLoadFile'
                , auto: false//选择文件后不自动上传
                , multiple: true
                , accept: 'images'
                , bindAction: '#BtnUploadImage'
                , choose: function (obj) {
                    var files = this.files = obj.pushFile(); //将每次选择的文件追加到文件队列
                    //读取本地文件
                    obj.preview(function (index, file, result) {
                        var imgname = "";
                        if (type == 0) {
                            $("#image1").val("0");
                            var htmls = "<span class=\"layui-inline layui-upload-choose\">" + file.name + "</span>";
                            $("#upload1").after(htmls);
                            imgname = "背景图片";
                        }
                        if (type == 1) {
                            $("#image2").val("0");
                            var htmls = "<span class=\"layui-inline layui-upload-choose\">" + file.name + "</span>";
                            $("#upload2").after(htmls);
                            imgname = "banner图";
                        }
                        var tr = $(['<tr id="upload-' + index + '">'
                            , '<td>' + imgname + '</td>'
                            , '<td>' + file.name + '</td>'
                            , '<td>' + (file.size / 1014).toFixed(1) + 'kb</td>'
                            , '<td>等待上传</td>'
                            , '<td>'
                            , '<button class="layui-btn layui-btn-xs demo-reload layui-hide">重传</button>'
                            , '</td>'
                            , '</tr>'].join(''));

                        //单个重传
                        tr.find('.demo-reload').on('click', function () {
                            obj.upload(index, file);
                        });

                        demoListView.append(tr);
                    });
                }
                , done: function (res, index, upload) {
                    if (res.code == 1) { //上传成功
                        var tr = demoListView.find('tr#upload-' + index)
                            , tds = tr.children();
                        if (tds.eq(0).html() == "背景图片") {
                            $("#image1url").val(res.datas[0].url);
                        } else {
                            $("#image2url").val(res.datas[0].url);
                        }
                        tds.eq(3).html('<span style="color: #5FB878;">上传成功</span>');
                        tds.eq(4).html(''); //清空操作
                        Update()//编辑
                        return delete this.files[index]; //删除文件队列已经上传成功的文件
                    }
                }
                , error: function (index, upload) {
                    var tr = demoListView.find('tr#upload-' + index)
                        , tds = tr.children();

                    tds.eq(3).html('<span style="color: #FF5722;">上传失败</span>');
                    tds.eq(4).find('.demo-reload').removeClass('layui-hide'); //显示重传
                }
            });

            $("#upload2").on("click", function () {
                type = 1;
                $("#uploadMaster").click();
            });

            $("#upload1").on("click", function () {
                type = 0;
                $("#uploadMaster").click();
            });

            function checkDate(StartDate, EndDate) {
                var start = new Date(StartDate.replace("-", "/").replace("-", "/"));
                var end = new Date(EndDate.replace("-", "/").replace("-", "/"));
                if (end < start) {
                    return false;
                } else {

                    return true;
                }
            }


            $("#next").on("click", function () {
                var AType = $("#AType").val();//活动类型
                var Title = $("#Title").val();//活动标题
                var StartDate = $("#StartDate").val();
                var EndDate = $("#EndDate").val();
                var StartTime = $("#StartTime").val();
                var EntTime = $("#EntTime").val();
                //var ConsumeScore = $("#ConsumeScore").val();
                //var DistributionScore = $("#DistributionScore").val();
                var LotteryNumber = $("#LotteryNumber").val();
                var ARule = $("#ARule").val();//活动规则
                //var upload1 = $("#image1").val();
                //var upload2 = $("#image2").val();
                var PriorityUse = $("input[name='PriorityUse']:checked").val();
                if (AType == "")
                    return layer.alert("请选择活动类型", { icon: 0 });
                if (Title == "")
                    return layer.alert("请选填写活动标题", { icon: 0 });
                //if (upload1 == "")
                //    return layer.alert("请选择要上传的背景图片", { icon: 0 });
                //if (upload2 == "")
                //    return layer.alert("请选择要上传的banner图", { icon: 0 });

                if (StartDate == "")
                    return layer.alert("请选择开始日期", { icon: 0 });
                if (EndDate == "")
                    return layer.alert("请选择结束日期", { icon: 0 });
                if (!checkDate(StartDate, EndDate))
                    return layer.alert("结束日期不能小于开始日期", { icon: 0 });
                if (StartTime == "")
                    return layer.alert("请选择每日开始时间", { icon: 0 });
                if (EntTime == "")
                    return layer.alert("请选择每日结束时间", { icon: 0 });
                if (!checkDate(("2018-10-01 " + StartTime), ("2018-10-01 " + EntTime)))
                    return layer.alert("每日结束时间不能小于开始时间", { icon: 0 });
                if (LotteryNumber == "")
                    return layer.alert("请输入抽奖次数", { icon: 0 });
                if (ARule == "")
                    return layer.alert("请填写活动规则", { icon: 0 });
                if (ARule.length > 100)
                    return layer.alert("请填写活动规则最多填写100个字符", { icon: 0 });

                $("#number1").hide();
                $("#number2").show();
                $("#b1").removeClass("layui-this").addClass("disabled");
                $("#b2").removeClass("layui-this").addClass("layui-this");
            });

            $("#Back").on("click", function () {
                $("#number2").hide();
                $("#number1").show();
                $("#b2").removeClass("layui-this").addClass("disabled");
                $("#b1").removeClass("layui-this").addClass("layui-this");
            });




            //更新方法
            function Update() {

                var ActivityID = getUrlParam("id");
                var AType = $("#AType").val();//活动类型
                var Title = $("#Title").val();//活动标题
                var StartDate = $("#StartDate").val();
                var EndDate = $("#EndDate").val();
                var StartTime = $("#StartTime").val();
                var EntTime = $("#EntTime").val();
                var ConsumeScore = "0";
                var DistributionScore = "0";
                var LotteryNumber = $("#LotteryNumber").val();
                var ARule = $("#ARule").val();//活动规则
                var PriorityUse = $("input[name='PriorityUse']:checked").val();

                var PrizeID = "";
                $("input[id^='PrizeID']").each(function () {
                    PrizeID += $(this).val() + ",";
                });
                var ATypes = "";
                $("#tbl select[id^='ATypes']").each(function () {
                    ATypes += $(this).val() + ",";
                });
                var PNames = "";
                $("#tbl select[name^='PName']").each(function () {
                    PNames += $(this).val() + ",";
                });

                var Inventorys = "";
                $("#tbl input[id^='Inventory']").each(function () {
                    Inventorys += $(this).val() + ",";
                });

                var Probabilitys = "";

                $("#tbl input[id^='Probability']").each(function () {
                    Probabilitys += $(this).val() + ",";

                });


                var BGImg = $("#image1url").val();
                var BannerImg = $("#image2url").val();

                var pm = {
                    ActivityID: ActivityID,
                    AType: AType,
                    Title: Title,
                    StartDate: StartDate,
                    EndDate: EndDate,
                    StartTime: StartTime,
                    EntTime: EntTime,
                    ConsumeScore: ConsumeScore,
                    DistributionScore: DistributionScore,
                    ARule: ARule,
                    PriorityUse: PriorityUse,
                    Probabilitys: Probabilitys,
                    Inventorys: Inventorys,
                    PNames: PNames,
                    ATypes: ATypes,
                    BGImg: BGImg,
                    BannerImg: BannerImg,
                    PrizeID: PrizeID,
                    LotteryNumber: LotteryNumber
                };
                console.log(pm)
                $.ajax({
                    url: "/ActivityManage/CopyReopen",
                    type: "post",
                    dataType: "json",
                    async: false,
                    data: pm,
                    success: function (data) {
                        if (data.code == "1") {
                            layer.alert(data.msg, { icon: 1 }, function () {
                                parent.layer.close(index);
                            });

                        } else {
                            layer.alert(data.msg, { icon: 2 });
                        }
                    }
                });
            }

            //提交事件
            $("#success").on("click", function () {

                var AType = $("#AType").val();//活动类型
                var Title = $("#Title").val();//活动标题
                var StartDate = $("#StartDate").val();
                var EndDate = $("#EndDate").val();
                var StartTime = $("#StartTime").val();
                var EntTime = $("#EntTime").val();
                var ConsumeScore = "0";
                var DistributionScore = "0";
                var LotteryNumber = $("#LotteryNumber").val();
                var ARule = $("#ARule").val();//活动规则
                var PriorityUse = $("input[name='PriorityUse']:checked").val();

                var num = 0; i = 0;
                $("#tbl select[id^='AType']").each(function () {
                    num++;
                    if ($(this).val() == "") {
                        i++;
                        return false;
                    }
                });
                if (i > 0)
                    return layer.alert("请选择序号：" + num + " 的奖项", { icon: 0 });

                var num = 0; i = 0;
                $("#tbl select[name^='PName']").each(function () {
                    num++;
                    if ($(this).val() == "") {
                        i++;
                        return false;
                    }
                });
                if (i > 0) {
                    layer.alert("请选择序号：" + num + " 的奖品名称", { icon: 0 });
                    return false;
                }

                var num = 0; i = 0;
                $("#tbl input[id^='Inventory']").each(function () {
                    num++;
                    if ($(this).val() == "") {
                        i++;
                        return false;
                    }
                });
                if (i > 0) {
                    layer.alert("请输入序号：" + num + " 的奖品数量", { icon: 0 });
                    return false;
                }

                var num = 0; i = 0;
                $("#tbl input[id^='Probability']").each(function () {
                    num++;
                    if ($(this).val() == "") {
                        i++;
                        return false;
                    }
                });
                if (i > 0) {
                    layer.alert("请输入序号：" + num + " 的中奖概率", { icon: 0 });
                    return false;
                }

                var ATypes = "";
                $("#tbl select[id^='AType']").each(function () {
                    ATypes += $(this).val() + ",";
                });
                var PNames = "";
                $("#tbl select[name^='PName']").each(function () {
                    PNames += $(this).val() + ",";
                });

                var Inventorys = "";
                $("#tbl input[id^='Inventory']").each(function () {
                    Inventorys += $(this).val() + ",";
                });

                var Probabilitys = "";

                var zhi = 0;
                var count = 0;
                $("#tbl input[id^='Probability']").each(function () {
                    Probabilitys += $(this).val() + ",";
                    if ($(this).val() != "") {
                        count++;
                        zhi += $(this).val() * 1;
                    }
                });
                if (zhi > 100)
                    return layer.msg("请检查设置，中奖率相加必须等于100%");
                if (count == 8 && zhi != 100)
                    return layer.msg("请检查设置，中奖率相加必须等于100%");

                if (!$("#demoList").find('tr:visible').length) {
                    Update();//编辑
                } else {
                    $("#BtnUploadImage").click();
                }
                //$.ajax({
                //    url: "/ActivityManage/InserActivity",
                //    dataType: "json",
                //    async: false,
                //    data: pm,
                //    success: function (data) {
                //        getList = data;

                //    }
                //});
            });


        });

    </script>
</body>
</html>
